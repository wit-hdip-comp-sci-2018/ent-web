<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/combine/npm/highlightjs@9.16.2,npm/jquery@3.4.1"></script>
    <script src="https://cdn.jsdelivr.net/combine/npm/highlightjs@9.16.2,npm/jquery@3.4.1,npm/jquery-address@1.6.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/railscasts.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <style>
      

body {
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
  font-size:90%;
  color: black;
}

p {
  margin: 0.5em;
}

pre code {
  font-family: "Monaco";
  font-size: 100%;
}

img {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  margin:10px;
}

h1, h2, h3 {
  border-bottom:thin solid black;
  margin-bottom: 0.5em;
  margin-top: 1em;
}

h1 {
  font-style:italic;
  font-size:130%;
}

h2 {
  font-size:110%;
}

h3 {
  font-size:100%;
}



      

html, body {
  height: 100%;
  margin: 0;
}
.wrapper {
  height: 100%;
  display: flex;
  flex-direction: column;
}
.footer {
  background: white;
  text-align: right;
}
.content {
  flex: 1;
  overflow: auto;
}



    </style>
  </head>

  
  

  <div class="ui fixed top pointing inverted stackable menu labmenu">
    <header class="header item">
      <i id="toc" class="sitemap icon"></i>
      
        <a href="../../index.html"> Maps & Aurelia Deployment  </a>
      
    </header>
    <div class="right tab-menu menu">
      
        <a class="item" data-tab="Lab-12c Map Panel">
          Lab-12c Map Panel
        </a>
      
        <a class="item" data-tab="01">
          01
        </a>
      
        <a class="item" data-tab="02">
          02
        </a>
      
        <a class="item" data-tab="03">
          03
        </a>
      
        <a class="item" data-tab="04">
          04
        </a>
      
        <a class="item" data-tab="05">
          05
        </a>
      
        <a class="item" data-tab="06">
          06
        </a>
      
        <a class="item" data-tab="Exercises">
          Exercises
        </a>
      
    </div>
  </div>


  

  <div class="ui pushable">
    <div class="ui inverted labeled icon left inline vertical sidebar menu">
      <br><br>
      
        
          
            <a class="item"
               href="/topic-01-js-client/unit-1/book-3-jquery/index.html">Lab 01a JQuery </a>
          
        
      
        
          
            <a class="item"
               href="/topic-01-js-client/unit-2/book-1-ajax-1/index.html">Lab 01b Github API </a>
          
        
      
        
          
            <a class="item"
               href="/topic-02-introducing-node/unit-1/book-1/index.html">Lab 02a FoureSquare API </a>
          
        
      
        
          
            <a class="item"
               href="/topic-02-introducing-node/unit-1/book-2/index.html">Lab 02b FoureSquare JS </a>
          
        
      
        
          
            <a class="item"
               href="/topic-02-introducing-node/unit-2/book-applications/index.html">Lab 02b Applications </a>
          
        
      
        
          
            <a class="item"
               href="/topic-03-hapi-apps/unit-1-views/book-views/index.html">Lab 03a Views </a>
          
        
      
        
          
            <a class="item"
               href="/topic-03-hapi-apps/unit-2-sessions/book-sessions/index.html">Lab 03b Sessions </a>
          
        
      
        
          
            <a class="item"
               href="/topic-04-mongo-db/unit-1/book-models/index.html">Lab 04a Models I </a>
          
        
      
        
          
            <a class="item"
               href="/topic-04-mongo-db/unit-2/book-1/index.html">Lab-04b Models II </a>
          
        
      
        
          
            <a class="item"
               href="/topic-05-deployment-seeding/unit-0-validation/book-1-validation/index.html">Lab 05a Validation </a>
          
        
      
        
          
            <a class="item"
               href="/topic-05-deployment-seeding/unit-1-deployment/book-2-deployment/index.html">Lab 05b Deployment </a>
          
        
      
        
          
            <a class="item"
               href="/topic-05-deployment-seeding/unit-2-db-seeding/book-seeding/index.html">Lab 05c Seeding </a>
          
        
      
        
          
            <a class="item"
               href="/topic-06-security-and-apis/unit-1-security-introduction/book-1-pgp-gpg/index.html">Lab 06a GPG </a>
          
        
      
        
          
            <a class="item"
               href="/topic-06-security-and-apis/unit-2-api/book-api/index.html">Lab 06b Apis </a>
          
        
      
        
          
            <a class="item"
               href="/topic-07-security-and-tdd/unit-1-security-foundations/book-1-openssl/index.html">Lab 07a OpenSSL and Certificates </a>
          
        
      
        
          
            <a class="item"
               href="/topic-07-security-and-tdd/unit-2-tdd/book-tdd/index.html">Lab 07b Tdd </a>
          
        
      
        
          
            <a class="item"
               href="/topic-08-tls-threats/unit-1-certificates+tls/book-1-tls-configuration/index.html">Lab 08a TLS </a>
          
        
      
        
          
            <a class="item"
               href="/topic-08-tls-threats/unit-2-webapp-threats+vulnerabilities/book-1-misuse-cases/index.html">Lab 08b Threat Modelling </a>
          
        
      
        
          
            <a class="item"
               href="/topic-09-authentication-rest/unit-1-web-app-authentication/book-1-web-authentication/index.html">Lab 09a Authentication techniques </a>
          
        
      
        
          
            <a class="item"
               href="/topic-09-authentication-rest/unit-2-rest/book-rest/index.html">Lab 09b Rest </a>
          
        
      
        
          
            <a class="item"
               href="/topic-10-pen-testing-aurelia-1/unit-1-pentesting/book-1-burp-proxy/index.html">Lab 10a Burp-Proxy </a>
          
        
      
        
          
            <a class="item"
               href="/topic-10-pen-testing-aurelia-1/unit-1-pentesting/book-2-regex/index.html">Lab 10b Regular Expressions </a>
          
        
      
        
          
            <a class="item"
               href="/topic-10-pen-testing-aurelia-1/unit-1-pentesting/book-3-xss/index.html">Lab 10c XSS tips </a>
          
        
      
        
          
            <a class="item"
               href="/topic-10-pen-testing-aurelia-1/unit-2-aurelia-a/book-au-1/index.html">Lab-10d Aurelia Components </a>
          
        
      
        
          
            <a class="item"
               href="/topic-10-pen-testing-aurelia-1/unit-2-aurelia-b/book-au-2/index.html">Lab 10e Aurelia Custom Elements </a>
          
        
      
        
          
            <a class="item"
               href="/topic-11-aurelia-2/unit-0-routers/book-au-3/index.html">Lab 11a Aurelia Router </a>
          
        
      
        
          
            <a class="item"
               href="/topic-11-aurelia-2/unit-1-services/book-au-4/index.html">Lab 11b Aurelia Services </a>
          
        
      
        
          
            <a class="item"
               href="/topic-11-aurelia-2/unit-2-events/book-au-5/index.html">Lab 11c Aurelia Event Aggregator </a>
          
        
      
        
          
            <a class="item"
               href="/topic-11-aurelia-2/unit-3-aurelia-authentication-1/book-au-6/index.html">Lab 11d User Models </a>
          
        
      
        
          
            <a class="item"
               href="/topic-11-aurelia-2/unit-3-aurelia-authentication-1/book-au-7/index.html">Lab 11e donation-client:donation-web </a>
          
        
      
        
          
            <a class="item"
               href="/topic-12-aurelia-3/unit-1/book-a-hapi-auth/index.html">Lab 12a Hapi-JWT </a>
          
        
      
        
          
            <a class="item"
               href="/topic-12-aurelia-3/unit-1/book-b-aurelia-jwt/index.html">Lab-12b Aurelia JWT </a>
          
        
      
        
          
            <a class="item"
               href="/topic-12-aurelia-3/unit-2/book-1-maps/index.html">Lab-12c Map Panel </a>
          
        
      
        
          
            <a class="item"
               href="/topic-12-aurelia-3/unit-2/book-2-maps-2/index.html">Lab-12d Map View </a>
          
        
      
        
          
            <a class="item"
               href="/topic-12-aurelia-3/unit-2/book-3-deployment/index.html">Lab-12e Deployment </a>
          
        
      
    </div>
    <div class="pusher" tabindex="-1">
      <div class="ui basic segment">
        <br>
        
          <div class="ui tab segment lab" data-tab="Lab-12c Map Panel">
            <h1>Objectives</h1>
<p>Incorporate a map into the donations view, showing location of latest donation.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="01">
            <h1>Location - Latitude / Longitude</h1>
<p>We can start by introducing a representation of locations in individual donation:</p>
<h2>src/services/donation-types.ts</h2>
<pre><code>export interface Location {
  lat: number;
  lng: number;
}

export interface Donation {
  amount: number;
  method: string;
  candidate: Candidate;
  location: Location;
}</code></pre>
<p>This custom element can the be used to allow a lat/lng pair to be entered:</p>
<h2>src/resources/elements/coordinates.html</h2>
<pre><code>&lt;template&gt;
  &lt;h4 class=&quot;ui dividing header&quot;&gt; Enter Coordinates &lt;/h4&gt;
  &lt;div class=&quot;two fields&quot;&gt;
    &lt;div class=&quot;field&quot;&gt;
      &lt;label&gt;Latitude&lt;/label&gt; &lt;input placeholder=&quot;00.000000&quot; value.bind=&quot;location.lat&quot;/&gt;
    &lt;/div&gt;
    &lt;div class=&quot;field&quot;&gt;
      &lt;label&gt;Longitude&lt;/label&gt; &lt;input placeholder=&quot;00.000000&quot; value.bind=&quot;location.lng&quot;/&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<h2>src/resources/elements/coordinates.ts</h2>
<pre><code>import { bindable } from &#39;aurelia-framework&#39;;
import { Location } from &#39;../../services/donation-types&#39;;

export class Coordinates {
  @bindable location: Location;
}</code></pre>

          </div>
        
          <div class="ui tab segment lab" data-tab="02">
            <h1>Donation Location</h1>
<p>We can now extend the donation service + viewmodels to allow the user to enter the location the donation is made from:</p>
<h2>src/services/donation-service.ts</h2>
<pre><code>...
import { Candidate, Donation, Location } from &#39;./donation-types&#39;;
...

  async donate(amount: number, method: string, candidate: Candidate, location : Location) {
    const donation = {
      amount: amount,
      method: method,
      candidate: candidate,
      location : location
    };
    const response = await this.httpClient.post(&#39;/api/candidates/&#39; + candidate._id + &#39;/donations&#39;, donation);
    this.donations.push(donation);
    this.total = this.total + amount;
    this.ea.publish(new TotalUpdate(this.total));
    console.log(&#39;Total so far &#39; + this.total);
  }</code></pre>
<p>In the above, we are accepting an additional parameter, the location object. </p>
<p>Now incorporate the coordinate custom element into the donation-form component:</p>
<h2>src/resources/elements/donation-form.html</h2>
<pre><code>&lt;template&gt;
  &lt;require from=&quot;./coordinates&quot;&gt;&lt;/require&gt;

  &lt;form submit.trigger=&quot;makeDonation()&quot; class=&quot;ui form stacked segment&quot;&gt;
    &lt;h3 class=&#39;ui dividing header&#39;&gt; Make a Donation &lt;/h3&gt;
    &lt;div class=&quot;grouped inline fields&quot;&gt;
      &lt;div class=&quot;field&quot;&gt;
        &lt;label&gt;Amount&lt;/label&gt; &lt;input type=&quot;number&quot; value.bind=&quot;amount&quot;&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;grouped inline fields&quot;&gt;
      &lt;div class=&quot;field&quot; repeat.for=&quot;method of paymentMethods&quot;&gt;
        &lt;div class=&quot;ui radio checkbox&quot;&gt;
          &lt;input type=&quot;radio&quot; model.bind=&quot;method&quot; checked.bind=&quot;selectedMethod&quot;&gt;
          &lt;label&gt;${method}&lt;/label&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;coordinates location.two-way=&quot;location&quot;&gt;&lt;/coordinates&gt;
    &lt;h4 class=&quot;ui dividing header&quot;&gt; Select Candidate &lt;/h4&gt;
    &lt;div class=&quot;grouped inline fields&quot;&gt;
      &lt;div class=&quot;field&quot; repeat.for=&quot;candidate of candidates&quot;&gt;
        &lt;div class=&quot;ui radio checkbox&quot;&gt;
          &lt;input type=&quot;radio&quot; model.bind=&quot;candidate&quot; checked.bind=&quot;selectedCandidate&quot;&gt;
          &lt;label&gt;${candidate.lastName}, ${candidate.firstName}&lt;/label&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;button class=&quot;ui blue submit button&quot;&gt;Donate&lt;/button&gt;
  &lt;/form&gt;
&lt;/template&gt;</code></pre>
<p>And in the view model, we can pass the entered location on to the donation-service:</p>
<h2>src/resources/elements/donate-form.ts</h2>
<pre><code>import { inject } from &#39;aurelia-framework&#39;;
import { bindable } from &#39;aurelia-framework&#39;;
import { Candidate, Location } from &#39;../../services/donation-types&#39;;
import { DonationService } from &#39;../../services/donation-service&#39;;

@inject(DonationService)
export class DonateForm {
  @bindable paymentMethods: string[];
  @bindable candidates: Candidate[];

  amount = &#39;0&#39;;
  selectedMethod = &#39;&#39;;
  selectedCandidate: Candidate = null;

  location: Location = { lat: 53.2734, lng: -7.7783203 };

  constructor(private ds: DonationService) {}

  makeDonation() {
    this.ds.donate(parseInt(this.amount), this.selectedMethod, this.selectedCandidate, this.location);
  }
}</code></pre>
<p>This should come together now - and donations with locations can be created:</p>
<p><img src="img/01.png" alt=""></p>

          </div>
        
          <div class="ui tab segment lab" data-tab="03">
            <h1>Leaflet</h1>
<p>Leaflet is a library encapsulating access to open source mapping systems:</p>
<ul>
<li><a href="https://leafletjs.com/">https://leafletjs.com/</a></li>
</ul>
<p>It provides a reasonable simple API for browser based maps. As it is available as an npm package, we can start by installing it into our aurelia app via yarn:</p>
<pre><code>yarn add leaflet</code></pre>
<p>We also need to include the leaflet css - this is best included in index.ejs in the project root:</p>
<h2>index.ejs</h2>
<pre><code>...
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/leaflet.css&quot;&gt;
...</code></pre>
<p>This is a wrapper class developed for the Oileain project - to simplify somewhat access to leaflet:</p>
<h2>src/services/leaflet-map.ts</h2>
<pre><code>import * as L from &#39;leaflet&#39;;
import Map = L.Map;
import Layer = L.Layer;
import LayersObject = L.Control.LayersObject;
import LayerGroup = L.LayerGroup;
import LayerControl = L.Control.Layers;
import { Location } from &#39;./donation-types&#39;;

export interface MapConfig {
  location: Location;
  zoom: number;
  minZoom: number;
}

export class LeafletMap {
  imap: Map;
  control: LayerControl;
  overlays: LayersObject = {};

  // https://leaflet-extras.github.io/leaflet-providers/preview/

  baseLayers = {
    Terrain: L.tileLayer(&#39;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;, {
      maxZoom: 17,
      attribution:
        &#39;Map data: &amp;copy; &lt;a href=&quot;https://www.openstreetmap.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors, &lt;a href=&quot;http://viewfinderpanoramas.org&quot;&gt;SRTM&lt;/a&gt; | Map style: &amp;copy; &lt;a href=&quot;https://opentopomap.org&quot;&gt;OpenTopoMap&lt;/a&gt; (&lt;a href=&quot;https://creativecommons.org/licenses/by-sa/3.0/&quot;&gt;CC-BY-SA&lt;/a&gt;)&#39;
    })
  };

  constructor(id: string, descriptor: MapConfig, activeLayer = &#39;&#39;) {
    let defaultLayer = this.baseLayers.Terrain;
    if (activeLayer) {
      defaultLayer = this.baseLayers[activeLayer];
    }
    this.imap = L.map(id, {
      center: [descriptor.location.lat, descriptor.location.lng],
      zoom: descriptor.zoom,
      minZoom: descriptor.minZoom,
      zoomControl: false,
      layers: [defaultLayer]
    });
  }

  addLayer(title: string, layer: Layer) {
    this.overlays[title] = layer;
    this.imap.addLayer(layer);
  }

  addLayerGroup(title: string) {
    this.overlays[title] = L.layerGroup([]);
    this.imap.addLayer(this.overlays[title]);
  }

  showLayerControl() {
    this.control = L.control.layers(this.baseLayers, this.overlays).addTo(this.imap);
  }

  showZoomControl(position = &#39;topleft&#39;) {
    L.control
      .zoom({
        position: position
      })
      .addTo(this.imap);
  }

  moveTo(zoom: number, location: Location) {
    this.imap.setZoom(zoom);
    this.imap.panTo(new L.LatLng(location.lat, location.lng));
  }

  zoomTo(location: Location) {
    this.imap.setView(new L.LatLng(location.lat, location.lng), 8);
  }

  addMarker(location: Location, popupText = &#39;&#39;, layerTitle = &#39;default&#39;) {
    let group: LayerGroup;
    let marker = L.marker([location.lat, location.lng]);
    if (popupText) {
      var popup = L.popup({ autoClose: false, closeOnClick: false });
      popup.setContent(popupText);
      marker.bindPopup(popup);
    }
    if (!this.overlays[layerTitle]) {
      group = L.layerGroup([]);
      this.overlays[layerTitle] = group;
      this.imap.addLayer(group);
    } else {
      group = this.overlays[layerTitle] as LayerGroup;
    }
    marker.addTo(group);
  }

  invalidateSize() {
    this.imap.invalidateSize();
    let hiddenMethodMap = this.imap as any;
    hiddenMethodMap._onResize();
  }
}</code></pre>
<p>The purpose of this class is to make it easier to add markers and pop ups, and also manage map layers of markers in a more streamlined manner.</p>
<p>We dont need to understand this class in order to use its features.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="04">
            <h1>Map Custom Element</h1>
<p>This is a custom element, which we can use in different views, to render a leaflet map containing a marker at the lat/lng contained in the donation:</p>
<h2>src/resources/elements/donation-map.html</h2>
<pre><code>&lt;template&gt;
  &lt;div class=&quot;ui stacked segment&quot;&gt;
    &lt;div id=&quot;${mapId}&quot; class=&quot;ui embed&quot; style=&quot;height:${mapHeight}px; z-index: 0&quot;&gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<h2>src/resources/elements/donation-map.ts</h2>
<pre><code>import { inject } from &#39;aurelia-framework&#39;;
import { EventAggregator } from &#39;aurelia-event-aggregator&#39;;
import { LeafletMap } from &#39;../../services/leaflet-map&#39;;

export class DonationMap {
  mapId = &#39;donations-map&#39;;
  mapHeight = 300;
  map: LeafletMap;

  constructor(private ea: EventAggregator) {}

  attached() {
    const mapConfig = {
      location: { lat: 53.2734, lng: -7.7783203 },
      zoom: 8,
      minZoom: 7
    };
    this.map = new LeafletMap(this.mapId, mapConfig, &#39;Terrain&#39;);
  }
}</code></pre>
<p>Try this out now - bring the above element into the donate component:</p>
<h2>src/views/donate.html</h2>
<pre><code>&lt;template&gt;
  &lt;require from=&quot;../resources/elements/donations-list&quot;&gt;&lt;/require&gt;
  &lt;require from=&quot;../resources/elements/donate-form&quot;&gt;&lt;/require&gt;
  &lt;require from=&quot;../resources/elements/total-donated&quot;&gt;&lt;/require&gt;
  &lt;require from=&quot;../resources/elements/donation-map&quot;&gt;&lt;/require&gt;

  &lt;div class=&quot;ui stackable grid&quot;&gt;
    &lt;div class=&quot;seven wide column&quot;&gt;
      &lt;donate-form payment-methods.bind=&quot;paymentMethods&quot; candidates.bind=&quot;candidates&quot;&gt;&lt;/donate-form&gt;
    &lt;/div&gt;
    &lt;div class=&quot;two wide column&quot;&gt;
      &lt;total-donated&gt;&lt;/total-donated&gt;
    &lt;/div&gt;
    &lt;div class=&quot;seven wide column&quot;&gt;
      &lt;donation-map&gt;&lt;/donation-map&gt;
      &lt;donations-list donations.bind=&quot;donations&quot;&gt;&lt;/donations-list&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<p>The map should now appear:</p>
<p><img src="img/02.png" alt=""></p>
<p>It doesn&#39;t display any markers (yet).</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="05">
            <h1>Markers</h1>
<p>One way of ensuring a marker appears at the donation location is to use the event aggregator. Whenever a donation is made, we can generate a donation message.</p>
<p>We have something like this already working when the total is changed:</p>
<h2>src/services/messages.ts</h2>
<pre><code>export class TotalUpdate {
  total: number;
  constructor(total: number) {
    this.total = total;
  }
}</code></pre>
<p>We could extend this to also carry the last donation made:</p>
<pre><code>import {Donation} from &quot;./donation-types&quot;;

export class TotalUpdate {
  total: number;
  donation : Donation;
  constructor(total: number, donation: Donation) {
    this.total = total;
    this.donation = donation;
  }
}</code></pre>
<p>When a donation is made, we need to ensure the TotalUpdate now also include the donation object:</p>
<h2>src/services/donation-service.ts</h2>
<pre><code>  async donate(amount: number, method: string, candidate: Candidate, location : Location) {
    const donation = {
      amount: amount,
      method: method,
      candidate: candidate,
      location : location
    };
    const response = await this.httpClient.post(&#39;/api/candidates/&#39; + candidate._id + &#39;/donations&#39;, donation);
    this.donations.push(donation);
    this.total = this.total + amount;
    this.ea.publish(new TotalUpdate(this.total, donation));
    console.log(&#39;Total so far &#39; + this.total);
  }</code></pre>
<p>This version of donation-map will subscribe to TotalUpdate messages, and place a marker on the map a the donation location:</p>
<h2>src/resources/elements/donation-map.ts</h2>
<pre><code>import { inject } from &#39;aurelia-framework&#39;;
import { EventAggregator } from &#39;aurelia-event-aggregator&#39;;
import { LeafletMap } from &#39;../../services/leaflet-map&#39;;
import { TotalUpdate } from &#39;../../services/messages&#39;;
import { Donation } from &#39;../../services/donation-types&#39;;

@inject(EventAggregator)
export class DonationMap {
  mapId = &#39;donations-map&#39;;
  mapHeight = 300;
  map: LeafletMap;

  constructor(private ea: EventAggregator) {
    ea.subscribe(TotalUpdate, msg =&gt; {
      this.renderDonation(msg.donation);
    });
  }

  renderDonation(donation: Donation) {
    if (this.map) {
      this.map.addMarker(donation.location);
      this.map.moveTo(12, donation.location);
    }
  }

  attached() {
    const mapConfig = {
      location: { lat: 53.2734, lng: -7.7783203 },
      zoom: 8,
      minZoom: 7
    };
    this.map = new LeafletMap(this.mapId, mapConfig, &#39;Terrain&#39;);
  }
}</code></pre>
<p>Try this now - log in and create a donation:</p>
<p><img src="img/03.png" alt=""></p>

          </div>
        
          <div class="ui tab segment lab" data-tab="06">
            <h1>Zoom Control &amp; Pop ups</h1>
<p>Add two donations at different location. The marker should appear at the new location. </p>
<p>We might like to zoom out to see all previous donations. We can turn on the zoom control just after creating the map:</p>
<pre><code>    attached() {
    const mapConfig = {
      location: { lat: 53.2734, lng: -7.7783203 },
      zoom: 8,
      minZoom: 7
    };
    this.map = new LeafletMap(this.mapId, mapConfig, &#39;Terrain&#39;);
    this.map.showZoomControl();
  }</code></pre>
<p>Create a few donations - and zooming out we should be able to see the markers:</p>
<p><img src="img/04.png" alt=""></p>
<p>The leaflet + wrapper has pop up support - we can define some content to appear when a user clicks on a marker.</p>
<p>This is created by just an additional parameter to addMarker:</p>
<pre><code>      const donationStr = `${donation.candidate.firstName} ${donation.candidate.lastName} €${donation.amount.toString()}`;
      this.map.addMarker(donation.location, donationStr);</code></pre>
<p>When you click on the marker - the donation details will appear:</p>
<p><img src="img/05.png" alt=""></p>

          </div>
        
          <div class="ui tab segment lab" data-tab="Exercises">
            <h1>Solution</h1>
<ul>
<li><a href="https://github.com/wit-hdip-comp-sci-2018/donation-au/releases/tag/donation.au.09.end">https://github.com/wit-hdip-comp-sci-2018/donation-au/releases/tag/donation.au.09.end</a></li>
</ul>

          </div>
        
      </div>
    </div>
  </div>


  <br>
  <script>
    $(document).on('keydown', function(e) {
  e = e || window.event;
  var nextTab;
  switch (e.which || e.keyCode) {
    case 37: // left
      nextTab = $('.tab-menu a[data-tab].active').prev('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').last();
      nextTab.click();
      $('.pusher').focus();
      break;

    case 39: // right
      nextTab = $('.tab-menu a[data-tab].active').next('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').first();
      nextTab.click();
      $('.pusher').focus();
      break;
  }
});

    $(document).ready(function() {
  $('img').addClass('ui image');

  $('.ui.embed').embed();

  const $images = $('.lab img');
  jQuery.each($images, function(i) {
    if ($images[i].alt.length > 0) {
      const divImg = $(document.createElement('div')).addClass(
        'ui basic segment',
      );
      $($images[i]).wrap(divImg);
      const divLabel = $(document.createElement('div')).addClass(
        'ui blue ribbon label',
      );
      divLabel.append($images[i].alt);
      $(divLabel).insertBefore($images[i]);
    }
  });

  $('.ui.menu .item').tab({
    history: true,
    historyType: 'hash',
  });

  $('.popup').popup();

  $('.ui.sidebar')
    .sidebar({ context: $('.pushable') })
    .sidebar('setting', 'transition', 'slide out')
    .sidebar('attach events', '#toc');
});

  </script>



  <div class="ui bottom fixed borderless right menu">
    <div class="ui right small menu">
      <div class="ui tiny basic message segment">
         Powered by <a href="https://github.com/edeleastar/tutors-ts">tutors-ts.</a> Unless otherwise stated, this work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
      </div>
    </div>
  </div>

  </body>

</html>