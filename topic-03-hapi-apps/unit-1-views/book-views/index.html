<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/combine/npm/highlightjs@9.16.2,npm/jquery@3.4.1"></script>
    <script src="https://cdn.jsdelivr.net/combine/npm/highlightjs@9.16.2,npm/jquery@3.4.1,npm/jquery-address@1.6.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/railscasts.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <style>
      

body {
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
  font-size:90%;
  color: black;
}

p {
  margin: 0.5em;
}

pre code {
  font-family: "Monaco";
  font-size: 100%;
}

img {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  margin:10px;
}

h1, h2, h3 {
  border-bottom:thin solid black;
  margin-bottom: 0.5em;
  margin-top: 1em;
}

h1 {
  font-style:italic;
  font-size:130%;
}

h2 {
  font-size:110%;
}

h3 {
  font-size:100%;
}



      

html, body {
  height: 100%;
  margin: 0;
}
.wrapper {
  height: 100%;
  display: flex;
  flex-direction: column;
}
.footer {
  background: white;
  text-align: right;
}
.content {
  flex: 1;
  overflow: auto;
}



    </style>
  </head>

  
  

  <div class="ui fixed top pointing inverted stackable menu labmenu">
    <header class="header item">
      <i id="toc" class="sitemap icon"></i>
      
        <a href="../../index.html"> 6: Views  </a>
      
    </header>
    <div class="right tab-menu menu">
      
        <a class="item" data-tab="Lab 03a Views">
          Lab 03a Views
        </a>
      
        <a class="item" data-tab="Lab-5-Solutions">
          Lab-5-Solutions
        </a>
      
        <a class="item" data-tab="02">
          02
        </a>
      
        <a class="item" data-tab="03">
          03
        </a>
      
        <a class="item" data-tab="04">
          04
        </a>
      
        <a class="item" data-tab="05">
          05
        </a>
      
        <a class="item" data-tab="06">
          06
        </a>
      
        <a class="item" data-tab="07">
          07
        </a>
      
        <a class="item" data-tab="Exercises">
          Exercises
        </a>
      
    </div>
  </div>


  

  <div class="ui pushable">
    <div class="ui inverted labeled icon left inline vertical sidebar menu">
      <br><br>
      
        
          
            <a class="item"
               href="/topic-01-js-client/unit-1/book-3-jquery/index.html">Lab 01a JQuery </a>
          
        
      
        
          
            <a class="item"
               href="/topic-01-js-client/unit-2/book-1-ajax-1/index.html">Lab 01b Github API </a>
          
        
      
        
          
            <a class="item"
               href="/topic-02-introducing-node/unit-1/book-1/index.html">Lab 02a FoureSquare API </a>
          
        
      
        
          
            <a class="item"
               href="/topic-02-introducing-node/unit-1/book-2/index.html">Lab 02b FoureSquare JS </a>
          
        
      
        
          
            <a class="item"
               href="/topic-02-introducing-node/unit-2/book-applications/index.html">Lab 02b Applications </a>
          
        
      
        
          
            <a class="item"
               href="/topic-03-hapi-apps/unit-1-views/book-views/index.html">Lab 03a Views </a>
          
        
      
        
          
            <a class="item"
               href="/topic-03-hapi-apps/unit-2-sessions/book-sessions/index.html">Lab 03b Sessions </a>
          
        
      
        
          
            <a class="item"
               href="/topic-04-mongo-db/unit-1/book-models/index.html">Lab 04a Models I </a>
          
        
      
        
          
            <a class="item"
               href="/topic-04-mongo-db/unit-2/book-1/index.html">Lab-04b Models II </a>
          
        
      
        
          
            <a class="item"
               href="/topic-05-deployment-seeding/unit-0-validation/book-1-validation/index.html">Lab 05a Validation </a>
          
        
      
        
          
            <a class="item"
               href="/topic-05-deployment-seeding/unit-1-deployment/book-2-deployment/index.html">Lab 05b Deployment </a>
          
        
      
        
          
            <a class="item"
               href="/topic-05-deployment-seeding/unit-2-db-seeding/book-seeding/index.html">Lab 05c Seeding </a>
          
        
      
        
          
            <a class="item"
               href="/topic-06-security-and-apis/unit-1-security-introduction/book-1-pgp-gpg/index.html">Lab 06a GPG </a>
          
        
      
        
          
            <a class="item"
               href="/topic-06-security-and-apis/unit-2-api/book-api/index.html">Lab 06b Apis </a>
          
        
      
        
          
            <a class="item"
               href="/topic-07-security-and-tdd/unit-1-security-foundations/book-1-openssl/index.html">Lab 07a OpenSSL and Certificates </a>
          
        
      
        
          
            <a class="item"
               href="/topic-07-security-and-tdd/unit-2-tdd/book-tdd/index.html">Lab 07b Tdd </a>
          
        
      
        
          
            <a class="item"
               href="/topic-08-tls-threats/unit-1-certificates+tls/book-1-tls-configuration/index.html">Lab 08a TLS </a>
          
        
      
        
          
            <a class="item"
               href="/topic-08-tls-threats/unit-2-webapp-threats+vulnerabilities/book-1-misuse-cases/index.html">Lab 08b Threat Modelling </a>
          
        
      
        
          
            <a class="item"
               href="/topic-09-authentication-rest/unit-1-web-app-authentication/book-1-web-authentication/index.html">Lab 09a Authentication techniques </a>
          
        
      
        
          
            <a class="item"
               href="/topic-09-authentication-rest/unit-2-rest/book-rest/index.html">Lab 09b Rest </a>
          
        
      
        
          
            <a class="item"
               href="/topic-10-pen-testing-aurelia-1/unit-1-pentesting/book-1-burp-proxy/index.html">Lab 10a Burp-Proxy </a>
          
        
      
        
          
            <a class="item"
               href="/topic-10-pen-testing-aurelia-1/unit-1-pentesting/book-2-regex/index.html">Lab 10b Regular Expressions </a>
          
        
      
        
          
            <a class="item"
               href="/topic-10-pen-testing-aurelia-1/unit-1-pentesting/book-3-xss/index.html">Lab 10c XSS tips </a>
          
        
      
        
          
            <a class="item"
               href="/topic-10-pen-testing-aurelia-1/unit-2-aurelia-a/book-au-1/index.html">Lab-10d Aurelia Components </a>
          
        
      
        
          
            <a class="item"
               href="/topic-10-pen-testing-aurelia-1/unit-2-aurelia-b/book-au-2/index.html">Lab 10e Aurelia Custom Elements </a>
          
        
      
        
          
            <a class="item"
               href="/topic-11-aurelia-2/unit-0-routers/book-au-3/index.html">Lab 11a Aurelia Router </a>
          
        
      
        
          
            <a class="item"
               href="/topic-11-aurelia-2/unit-1-services/book-au-4/index.html">Lab 11b Aurelia Services </a>
          
        
      
        
          
            <a class="item"
               href="/topic-11-aurelia-2/unit-2-events/book-au-5/index.html">Lab 11c Aurelia Event Aggregator </a>
          
        
      
        
          
            <a class="item"
               href="/topic-11-aurelia-2/unit-3-aurelia-authentication-1/book-au-6/index.html">Lab 11d User Models </a>
          
        
      
        
          
            <a class="item"
               href="/topic-11-aurelia-2/unit-3-aurelia-authentication-1/book-au-7/index.html">Lab 11e donation-client:donation-web </a>
          
        
      
        
          
            <a class="item"
               href="/topic-12-aurelia-3/unit-1/book-a-hapi-auth/index.html">Lab 12a Hapi-JWT </a>
          
        
      
        
          
            <a class="item"
               href="/topic-12-aurelia-3/unit-1/book-b-aurelia-jwt/index.html">Lab-12b Aurelia JWT </a>
          
        
      
        
          
            <a class="item"
               href="/topic-12-aurelia-3/unit-2/book-1-maps/index.html">Lab-12c Map Panel </a>
          
        
      
        
          
            <a class="item"
               href="/topic-12-aurelia-3/unit-2/book-2-maps-2/index.html">Lab-12d Map View </a>
          
        
      
        
          
            <a class="item"
               href="/topic-12-aurelia-3/unit-2/book-3-deployment/index.html">Lab-12e Deployment </a>
          
        
      
    </div>
    <div class="pusher" tabindex="-1">
      <div class="ui basic segment">
        <br>
        
          <div class="ui tab segment lab" data-tab="Lab 03a Views">
            <h1>Objectives</h1>
<p>Extend the application to employ layouts, templates, and partials. Include simple interaction features to track users and donations.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="Lab-5-Solutions">
            <h1>Exercise Solutions</h1>
<p>Incorporate all of the assets from Lab-02b exercises step into the project:</p>
<p><img src="img/03.png" alt=""></p>
<p>(Note that <code>main.html</code> contains additional elements, so replace your version with the copy in the exercises).</p>
<p>Here are the revised routes &amp; controller:</p>
<h2>routes.js</h2>
<pre><code>const Donations = require(&#39;./app/controllers/donations&#39;);

module.exports = [
  { method: &#39;GET&#39;, path: &#39;/&#39;, config: Donations.index },
  { method: &#39;GET&#39;, path: &#39;/signup&#39;, config: Donations.signup },
  { method: &#39;GET&#39;, path: &#39;/login&#39;, config: Donations.login },
  {
    method: &#39;GET&#39;,
    path: &#39;/{param*}&#39;,
    handler: {
      directory: {
        path: &#39;./public&#39;
      }
    }
  }
];</code></pre>
<h2>app/controllers/donations.js</h2>
<pre><code>&#39;use strict&#39;;

const Donations = {
  index: {
    handler: async function(request, h) {
      return h.file(&#39;./app/views/main.html&#39;);
    }
  },
  signup: {
    handler: async function(request, h) {
      return h.file(&#39;./app/views/signup.html&#39;);
    }
  },
  login: {
    handler: async function(request, h) {
      return h.file(&#39;./app/views/login.html&#39;);
    }
  }
};

module.exports = Donations;</code></pre>

          </div>
        
          <div class="ui tab segment lab" data-tab="02">
            <h1>Introduce vision HAPI plugin + handlebars engine</h1>
<p>HAPI view support enables more sophisticated user interactions than simply rendering static pages.</p>
<ul>
<li><a href="http://hapijs.com/tutorials/views">http://hapijs.com/tutorials/views</a></li>
</ul>
<p>To engage, you must install this HAPI module:</p>
<ul>
<li><a href="https://github.com/hapijs/vision">https://github.com/hapijs/vision</a></li>
</ul>
<p>via this command:</p>
<pre><code>npm install vision</code></pre>
<p>We will use the handlebar engine:</p>
<ul>
<li><a href="http://handlebarsjs.com">http://handlebarsjs.com</a></li>
</ul>
<p>This must be installed separately with another npm command:</p>
<pre><code>npm install handlebars</code></pre>
<p>If successful, your package.json should look like this:</p>
<h2>package.json</h2>
<pre><code>{
  &quot;name&quot;: &quot;donation-web&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;index.js&quot;,
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  },
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;dependencies&quot;: {
    &quot;handlebars&quot;: &quot;^4.0.12&quot;,
    &quot;hapi&quot;: &quot;^18.0.0&quot;,
    &quot;inert&quot;: &quot;^5.1.2&quot;,
    &quot;vision&quot;: &quot;^5.4.4&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;prettier&quot;: &quot;^1.16.0&quot;
  },
  &quot;prettier&quot;: {
    &quot;singleQuote&quot;: true,
    &quot;printWidth&quot;: 120
  }
}</code></pre>
<p>Initialising this plugin requires registration as with <code>inert</code>, but also an additional step to configure these plugin. This is a revised index.js:</p>
<h2>index.js</h2>
<pre><code>&#39;use strict&#39;;

const Hapi = require(&#39;hapi&#39;);

const server = Hapi.server({
  port: 3000,
  host: &#39;localhost&#39;
});

async function init() {
  await server.register(require(&#39;inert&#39;));
  await server.register(require(&#39;vision&#39;));

  server.views({
    engines: {
      hbs: require(&#39;handlebars&#39;)
    },
    relativeTo: __dirname,
    path: &#39;./app/views&#39;,
    isCached: false
  });

  server.route(require(&#39;./routes&#39;));
  await server.start();
  console.log(`Server running at: ${server.info.uri}`);
}

process.on(&#39;unhandledRejection&#39;, err =&gt; {
  console.log(err);
  process.exit(1);
});

init();</code></pre>

          </div>
        
          <div class="ui tab segment lab" data-tab="03">
            <h1>First Handlebar Expressions</h1>
<p>Rename each of the view from <code>.html</code> to <code>.hbs</code>:</p>
<p><img src="img/01.png" alt=""></p>
<p>Currently the <code>&lt;title&gt;</code> element of each view is hard coded. Replace this element in each view with a handlebars style parameter:</p>
<h2>main.hbs</h2>
<pre><code>    &lt;title&gt;{{title}}&lt;/title&gt;</code></pre>
<h2>signup.hbs</h2>
<pre><code>    &lt;title&gt;{{title}}&lt;/title&gt;</code></pre>
<h2>login.hbs</h2>
<pre><code>    &lt;title&gt;{{title}}&lt;/title&gt;</code></pre>
<p>We can now refactor the controller to pass the actual title to the view when is is being rendered:</p>
<h2>app/controllers/donations.js</h2>
<pre><code>&#39;use strict&#39;;

const Donations = {
  index: {
    handler: function(request, h) {
      return h.view(&#39;main&#39;, { title: &#39;Welcome to Donations&#39; });
    }
  },
  signup: {
    handler: function(request, h) {
      return h.view(&#39;signup&#39;, { title: &#39;Sign up for Donations&#39; });
    }
  },
  login: {
    handler: function(request, h) {
      return h.view(&#39;login&#39;, { title: &#39;Login to Donations&#39; });
    }
  }
};

module.exports = Donations;</code></pre>
<p>Test this out now. There should be no noticeable change.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="04">
            <h1>Vision Layout + Handlebar Partials</h1>
<p>A key tenet of view structure is DRY (dont repeat yourself):</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">https://en.wikipedia.org/wiki/Don%27t_repeat_yourself</a></li>
</ul>
<p>Currently our views are very verbose and repetitive. We can start to address this via handlebars <code>layouts</code> and <code>partials</code>. </p>
<p>Layouts are part of the <code>vision</code> implementation:</p>
<ul>
<li><a href="http://hapijs.com/tutorials/views">http://hapijs.com/tutorials/views</a></li>
</ul>
<p>.. and partials are implemented by the handlebars engine:</p>
<ul>
<li><a href="http://handlebarsjs.com/partials.html">http://handlebarsjs.com/partials.html</a></li>
</ul>
<p>First, we need to configure the Vision plugin to use layouts and partials. Extend its initalisation as follows:</p>
<h2>index.js</h2>
<pre><code>  server.views({
    engines: {
      hbs: require(&#39;handlebars&#39;),
    },
    relativeTo: __dirname,
    path: &#39;./app/views&#39;,
    layoutPath: &#39;./app/views/layouts&#39;,
    partialsPath: &#39;./app/views/partials&#39;,
    layout: true,
    isCached: false,
  });</code></pre>
<h2>Layouts</h2>
<p>We can now set up a layout to be used by most of our views. Create the layout in a <code>layouts</code> folder in <code>views</code>:</p>
<h2>app/views/layouts/layout.hbs</h2>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;{{title}}&lt;/title&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; media=&quot;screen&quot; href=&quot;//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css&quot; /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;section class=&quot;ui container&quot;&gt;
      {{{content}}}
    &lt;/section&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>This will be the base view for our other views.</p>
<h2>Partials</h2>
<p>We can also create a reusable <code>partial</code> that we can include explicitly in other views. Create this in  <code>partials</code> folder in <code>views</code>:</p>
<h2>app/views/partials/welcomemenu.hbs</h2>
<pre><code>&lt;nav class=&quot;ui inverted menu&quot;&gt;
  &lt;header class=&quot;header item&quot;&gt; &lt;a href=&quot;/&quot;&gt; Donation &lt;/a&gt; &lt;/header&gt;
  &lt;div class=&quot;right menu&quot;&gt;
    &lt;a class=&quot;item&quot; href=&quot;/signup&quot;&gt; Signup&lt;/a&gt;
    &lt;a class=&quot;item&quot; href=&quot;/login&quot;&gt;  Login&lt;/a&gt;
  &lt;/div&gt;
&lt;/nav&gt;</code></pre>
<h2>Views</h2>
<p>We can now adapt all of the views to use these artifacts:</p>
<h2>app/views/main.hbs</h2>
<pre><code>{{&gt; welcomemenu }}

&lt;section class=&quot;ui stacked segment&quot;&gt;
  &lt;div class=&quot;ui grid&quot;&gt;
    &lt;aside class=&quot;six wide column&quot;&gt;
      &lt;img src=&quot;images/homer.png&quot; class=&quot;ui medium image&quot;&gt;
    &lt;/aside&gt;
    &lt;article class=&quot;ten wide column&quot;&gt;
      &lt;header class=&quot;ui  header&quot;&gt; Help Me Run Springfield&lt;/header&gt;
      &lt;p&gt; Donate what you can now - No Bitcoins accepted! &lt;/p&gt;
    &lt;/article&gt;
  &lt;/div&gt;
&lt;/section&gt;</code></pre>
<h2>app/views/signup.hbs</h2>
<pre><code>{{&gt; welcomemenu }}

&lt;section class=&quot;ui raised segment&quot;&gt;
  &lt;div class=&quot;ui grid&quot;&gt;
    &lt;div class=&quot;ui ten wide column&quot;&gt;
      &lt;div class=&quot;ui stacked fluid form segment&quot;&gt;
        &lt;form action=&quot;/signup&quot; method=&quot;POST&quot;&gt;
          &lt;h3 class=&quot;ui header&quot;&gt;Register&lt;/h3&gt;
          &lt;div class=&quot;two fields&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
              &lt;label&gt;First Name&lt;/label&gt;
              &lt;input placeholder=&quot;First Name&quot; type=&quot;text&quot; name=&quot;firstName&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;field&quot;&gt;
              &lt;label&gt;Last Name&lt;/label&gt;
              &lt;input placeholder=&quot;Last Name&quot; type=&quot;text&quot; name=&quot;lastName&quot;&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          &lt;div class=&quot;field&quot;&gt;
            &lt;label&gt;Email&lt;/label&gt;
            &lt;input placeholder=&quot;Email&quot; type=&quot;text&quot; name=&quot;email&quot;&gt;
          &lt;/div&gt;
          &lt;div class=&quot;field&quot;&gt;
            &lt;label&gt;Password&lt;/label&gt;
            &lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;
          &lt;/div&gt;
          &lt;button class=&quot;ui blue submit button&quot;&gt;Submit&lt;/button&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;aside class=&quot;ui five wide column&quot;&gt;
      &lt;img src=&quot;images/homer3.png&quot; class=&quot;ui medium image&quot;&gt;
    &lt;/aside&gt;
  &lt;/div&gt;
&lt;/section&gt;</code></pre>
<h2>app/views/login.hbs</h2>
<pre><code>{{&gt; welcomemenu }}

&lt;section class=&quot;ui raised segment&quot;&gt;
  &lt;div class=&quot;ui grid&quot;&gt;
    &lt;aside class=&quot;ui six wide column&quot;&gt;
      &lt;img src=&quot;images/homer2.png&quot; class=&quot;ui medium image&quot;&gt;
    &lt;/aside&gt;
    &lt;div class=&quot;ui ten wide column fluid form&quot;&gt;
      &lt;div class=&quot;ui stacked segment&quot;&gt;
        &lt;form action=&quot;/login&quot; method=&quot;POST&quot;&gt;
          &lt;h3 class=&quot;ui header&quot;&gt;Log-in&lt;/h3&gt;
          &lt;div class=&quot;field&quot;&gt;
            &lt;label&gt;Email&lt;/label&gt; &lt;input placeholder=&quot;Email&quot; type=&quot;text&quot;
                                        name=&quot;email&quot;&gt;
          &lt;/div&gt;
          &lt;div class=&quot;field&quot;&gt;
            &lt;label&gt;Password&lt;/label&gt; &lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;
          &lt;/div&gt;
          &lt;button class=&quot;ui blue submit button&quot;&gt;Login&lt;/button&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/section&gt;</code></pre>

          </div>
        
          <div class="ui tab segment lab" data-tab="05">
            <h1>Report and Home Views + partials</h1>
<p>With this infrastructure in place, we can incorporate the remaining views for our application. This will involve additional partials + views structured as follows in the project:</p>
<p><img src="img/02.png" alt=""></p>
<h1>Partials</h1>
<h2>donate.hbs</h2>
<pre><code>&lt;section class=&quot;ui raised segment&quot;&gt;
  &lt;div class=&quot;ui grid &quot;&gt;
    &lt;div class=&quot;ui form six wide column&quot;&gt;
      &lt;div class=&quot;ui stacked segment&quot;&gt;
        &lt;form action=&quot;/donate&quot; method=&quot;POST&quot;&gt;
          &lt;div class=&quot;ui dropdown&quot; name=&quot;amount&quot;&gt;
            &lt;input type=&quot;hidden&quot; name=&quot;amount&quot;&gt;
            &lt;div class=&quot;text&quot;&gt;Select Amount&lt;/div&gt;
            &lt;i class=&quot;ui dropdown icon&quot;&gt;&lt;/i&gt;
            &lt;div class=&quot;menu&quot;&gt;
              &lt;div class=&quot;item&quot;&gt;50&lt;/div&gt;
              &lt;div class=&quot;item&quot;&gt;100&lt;/div&gt;
              &lt;div class=&quot;item&quot;&gt;1000&lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          &lt;div class=&quot;grouped inline fields&quot;&gt;
            &lt;div class=&quot;field&quot;&gt;
              &lt;div class=&quot;ui radio checkbox&quot;&gt;
                &lt;input type=&quot;radio&quot; name=&quot;method&quot; value=&quot;paypal&quot;&gt;
                &lt;label&gt;Paypal&lt;/label&gt;
              &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class=&quot;field&quot;&gt;
              &lt;div class=&quot;ui radio checkbox&quot;&gt;
                &lt;input type=&quot;radio&quot; name=&quot;method&quot; value=&quot;direct&quot;&gt;
                &lt;label&gt;Direct&lt;/label&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          &lt;button class=&quot;ui blue submit button&quot;&gt;Donate&lt;/button&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;aside class=&quot;six wide column&quot;&gt;
      &lt;img src=&quot;images/homer4.jpeg&quot; class=&quot;ui medium image&quot;&gt;
    &lt;/aside&gt;
  &lt;/div&gt;
&lt;/section&gt;</code></pre>
<h2>donationlist.hbs</h2>
<pre><code>&lt;section class=&quot;ui raised segment&quot;&gt;
  &lt;div class=&quot;ui grid&quot;&gt;
    &lt;aside class=&quot;six wide column&quot;&gt;
      &lt;img src=&quot;images/homer5.jpg&quot; class=&quot;ui medium image&quot;&gt;
    &lt;/aside&gt;
    &lt;article class=&quot;eight wide column&quot;&gt;
      &lt;table class=&quot;ui celled table segment&quot;&gt;
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th&gt;Amount&lt;/th&gt;
            &lt;th&gt;Method donated&lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
          {{#each donations}}
            &lt;tr&gt;
              &lt;td&gt; {{amount}} &lt;/td&gt;
              &lt;td&gt; {{method}} &lt;/td&gt;
            &lt;/tr&gt;
          {{/each}}
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/article&gt;
  &lt;/div&gt;
&lt;/section&gt;</code></pre>
<h1>Views</h1>
<h2>home.hbs</h2>
<pre><code>&lt;nav class=&quot;ui inverted menu&quot;&gt;
  &lt;header class=&quot;header item&quot;&gt;&lt;a href=&quot;/&quot;&gt; Donation &lt;/a&gt;&lt;/header&gt;
  &lt;div class=&quot;right menu&quot;&gt;
    &lt;a class=&quot;active item&quot; href=&quot;/home&quot;&gt; Donate&lt;/a&gt;
    &lt;a class=&quot;item&quot; href=&quot;/report&quot;&gt; Report&lt;/a&gt;
    &lt;a class=&quot;item&quot; href=&quot;/logout&quot;&gt; Logout&lt;/a&gt;
  &lt;/div&gt;
&lt;/nav&gt;

&lt;section class=&quot;ui raised segment&quot;&gt;

  {{&gt; donate }}

  &lt;div class=&quot;ui  divider&quot;&gt;&lt;/div&gt;

  &lt;div class=&quot;ui teal progress&quot; data-percent=&quot;${progress}&quot; id=&quot;mainprogress&quot;&gt;
    &lt;div class=&quot;bar&quot;&gt;&lt;/div&gt;
  &lt;/div&gt;

&lt;/section&gt;</code></pre>
<h2>report.hbs</h2>
<pre><code>&lt;nav class=&quot;ui inverted menu&quot;&gt;
  &lt;header class=&quot;header item&quot;&gt; &lt;a href=&quot;/&quot;&gt; Donation &lt;/a&gt; &lt;/header&gt;
  &lt;div class=&quot;right menu&quot;&gt;
    &lt;a class=&quot;item&quot; href=&quot;/home&quot;&gt; Donate&lt;/a&gt;
    &lt;a class=&quot;active item&quot; href=&quot;/report&quot;&gt;  Report&lt;/a&gt;
    &lt;a class=&quot;item&quot; href=&quot;/logout&quot;&gt;  Logout&lt;/a&gt;
  &lt;/div&gt;
&lt;/nav&gt;

{{&gt; donationlist }}</code></pre>
<h1>Layout</h1>
<p>We also make this adjustment to the layout (to support dropdown controls)</p>
<h2>layout.hbs</h2>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;{{title}}&lt;/title&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; media=&quot;screen&quot; href=&quot;//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css&quot; /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;section class=&quot;ui container&quot;&gt;
      {{{content}}}
    &lt;/section&gt;
    &lt;script&gt;
      $(document).ready(function () {
        $(&#39;.ui.dropdown&#39;).dropdown({ on: &#39;hover&#39; });
      });
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>

          </div>
        
          <div class="ui tab segment lab" data-tab="06">
            <h1>Accounts and Donations Controllers + Routes</h1>
<p>We will rework the controllers, creating an new <code>Accounts</code> controller to handle user accounts, login etc...:</p>
<h2>accounts.js</h2>
<pre><code>&#39;use strict&#39;;

const Accounts = {
  index: {
    handler: function(request, h) {
      return h.view(&#39;main&#39;, { title: &#39;Welcome to Donations&#39; });
    }
  },
  showSignup: {
    handler: function(request, h) {
      return h.view(&#39;signup&#39;, { title: &#39;Sign up for Donations&#39; });
    }
  },
  signup: {
    handler: function(request, h) {
      return h.redirect(&#39;/home&#39;);
    }
  },
  showLogin: {
    handler: function(request, h) {
      return h.view(&#39;login&#39;, { title: &#39;Login to Donations&#39; });
    }
  },
  login: {
    handler: function(request, h) {
      return h.redirect(&#39;/home&#39;);
    }
  },
  logout: {
    handler: function(request, h) {
      return h.redirect(&#39;/&#39;);
    }
  }
};

module.exports = Accounts;</code></pre>
<p>We can then refactor the donations controller to support making and listing donations:</p>
<h2>donations.js</h2>
<pre><code>&#39;use strict&#39;;

const Donations = {
  home: {
    handler: function(request, h) {
      return h.view(&#39;home&#39;, { title: &#39;Make a Donation&#39; });
    }
  },
  report: {
    handler: function(request, h) {
      return h.view(&#39;report&#39;, { title: &#39;Donations so far&#39; });
    }
  }
};

module.exports = Donations;</code></pre>
<p>This is the revised routes that serves these controllers:</p>
<pre><code>&#39;use strict&#39;;

const Accounts = require(&#39;./app/controllers/accounts&#39;);
const Donations = require(&#39;./app/controllers/donations&#39;);

module.exports = [
  { method: &#39;GET&#39;, path: &#39;/&#39;, config: Accounts.index },
  { method: &#39;GET&#39;, path: &#39;/signup&#39;, config: Accounts.showSignup },
  { method: &#39;GET&#39;, path: &#39;/login&#39;, config: Accounts.showLogin },
  { method: &#39;GET&#39;, path: &#39;/logout&#39;, config: Accounts.logout },
  { method: &#39;POST&#39;, path: &#39;/signup&#39;, config: Accounts.signup },
  { method: &#39;POST&#39;, path: &#39;/login&#39;, config: Accounts.login },

  { method: &#39;GET&#39;, path: &#39;/home&#39;, config: Donations.home },
  { method: &#39;GET&#39;, path: &#39;/report&#39;, config: Donations.report },

  {
    method: &#39;GET&#39;,
    path: &#39;/{param*}&#39;,
    handler: {
      directory: {
        path: &#39;./public&#39;
      }
    }
  }
];</code></pre>
<p>You should be able to navigate through login to the home screen now. However, if you make a donation you will get an error.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="07">
            <h1>Very Simple Donation Persistence</h1>
<p>We can try to store some of the donations the user makes in an simple array. In <code>index.js</code>, include the following just before the init function is defined:</p>
<h2>index.js</h2>
<pre><code>server.bind({
  donations: [],
});</code></pre>
<p>Introduce this additional route, which is a <code>POST</code> route to accept donations:</p>
<h2>routes.js</h2>
<pre><code>  ...
  { method: &#39;POST&#39;, path: &#39;/donate&#39;, config: Donations.donate },
  ...</code></pre>
<p>We can now refactor the donations controller to store and retrieve these donations:</p>
<h2>app/controllers/donations.js</h2>
<pre><code>&#39;use strict&#39;;

const Donations = {
  home: {
    handler: function(request, h) {
      return h.view(&#39;home&#39;, { title: &#39;Make a Donation&#39; });
    }
  },
  report: {
    handler: function(request, h) {
      return h.view(&#39;report&#39;, {
        title: &#39;Donations to Date&#39;,
        donations: this.donations
      });
    }
  },
  donate: {
    handler: function(request, h) {
      const data = request.payload;
      this.donations.push(data);
      return h.redirect(&#39;/report&#39;);
    }
  }
};

module.exports = Donations;</code></pre>
<p>Rerun the app again - this time, if you proceed through login, you should be able to make donations, and see them on the report view.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="Exercises">
            <h1>Exercises: Track Users and Associate with Donations</h1>
<p>Archive of the project so far:</p>
<ul>
<li><a href="https://github.com/wit-hdip-comp-sci-2018/donation-web/releases/tag/donation.02.end">https://github.com/wit-hdip-comp-sci-2018/donation-web/releases/tag/donation.02.end</a></li>
</ul>
<h1>Exercise 1: Register Users</h1>
<p>As well as storing the donations in the server bound objects:</p>
<pre><code>server.bind({
  donations: [],
});</code></pre>
<p>Try also storing a list of users - in a similar manner to to the donations:</p>
<pre><code>server.bind({
  users: [],
  donations: [],
});</code></pre>
<p>Using the donations controller as a guide, see if you can populate this array with new users as they are registered. We already. have the route in place:</p>
<pre><code>  { method: &#39;POST&#39;, path: &#39;/signup&#39;, config: Accounts.signup },</code></pre>
<p>and a matching handler - which you will have to enhance.</p>
<pre><code>  signup: {
    handler: function(request, h) {
      return h.redirect(&#39;/home&#39;);
    }
  },</code></pre>
<h2>Exercise 2: Current User</h2>
<p>Try also to keep track of the current user:</p>
<pre><code>server.bind({
  currentUser : {},
  users: [],
  donations: [],
});</code></pre>
<p>Adjust your login controller to update this field.</p>
<p>On the report - include an extra column - <code>donor</code> - which should list the name of the donor (the user who is currently logged in).</p>

          </div>
        
      </div>
    </div>
  </div>


  <br>
  <script>
    $(document).on('keydown', function(e) {
  e = e || window.event;
  var nextTab;
  switch (e.which || e.keyCode) {
    case 37: // left
      nextTab = $('.tab-menu a[data-tab].active').prev('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').last();
      nextTab.click();
      $('.pusher').focus();
      break;

    case 39: // right
      nextTab = $('.tab-menu a[data-tab].active').next('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').first();
      nextTab.click();
      $('.pusher').focus();
      break;
  }
});

    $(document).ready(function() {
  $('img').addClass('ui image');

  $('.ui.embed').embed();

  const $images = $('.lab img');
  jQuery.each($images, function(i) {
    if ($images[i].alt.length > 0) {
      const divImg = $(document.createElement('div')).addClass(
        'ui basic segment',
      );
      $($images[i]).wrap(divImg);
      const divLabel = $(document.createElement('div')).addClass(
        'ui blue ribbon label',
      );
      divLabel.append($images[i].alt);
      $(divLabel).insertBefore($images[i]);
    }
  });

  $('.ui.menu .item').tab({
    history: true,
    historyType: 'hash',
  });

  $('.popup').popup();

  $('.ui.sidebar')
    .sidebar({ context: $('.pushable') })
    .sidebar('setting', 'transition', 'slide out')
    .sidebar('attach events', '#toc');
});

  </script>



  <div class="ui bottom fixed borderless right menu">
    <div class="ui right small menu">
      <div class="ui tiny basic message segment">
         Powered by <a href="https://github.com/edeleastar/tutors-ts">tutors-ts.</a> Unless otherwise stated, this work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
      </div>
    </div>
  </div>

  </body>

</html>